# 角色与权限API文档

## 概述
角色与权限模块提供角色管理与角色菜单权限配置能力，并通过菜单 code 实现动态权限校验。

## 通用说明
- 所有API接口返回JSON格式数据
- 日期时间字段使用毫秒时间戳格式
- 所有接口均需提供有效的认证信息
- 接口路径默认前缀为 `/api`

## 权限标识
- 权限标识使用菜单 code
- 角色管理权限：ROLE_MANAGE
- 权限分配权限：PERMISSION_ASSIGN

## 角色管理接口
### 1. 创建角色
- **接口地址**: `POST /api/roles`
- **功能描述**: 创建新的角色
- **请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| name | String | 是 | 角色名称 |
| description | String | 否 | 角色描述 |

- **请求示例**:
```json
{
  "name": "MANAGER",
  "description": "经理角色"
}
```

- **响应参数**:
| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 角色信息 |
| data.id | String | 角色ID |
| data.name | String | 角色名称 |
| data.description | String | 角色描述 |
| data.createTime | Long | 创建时间 |
| data.updateTime | Long | 更新时间 |
| data.createUserId | String | 创建用户ID |
| data.updateUserId | String | 更新用户ID |

### 2. 更新角色
- **接口地址**: `PUT /api/roles/{id}`
- **功能描述**: 更新角色信息
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | String | 是 | 角色ID |

- **请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| name | String | 是 | 角色名称 |
| description | String | 否 | 角色描述 |

- **请求示例**:
```json
{
  "name": "MANAGER",
  "description": "经理角色更新"
}
```

- **响应参数**: 同创建角色接口

### 3. 删除角色
- **接口地址**: `DELETE /api/roles/{id}`
- **功能描述**: 删除指定角色
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | String | 是 | 角色ID |

- **响应参数**:
| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Boolean | 删除结果 |

### 4. 角色详情
- **接口地址**: `GET /api/roles/{id}`
- **功能描述**: 获取角色详情
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | String | 是 | 角色ID |

- **响应参数**: 同创建角色接口

### 5. 角色列表
- **接口地址**: `GET /api/roles`
- **功能描述**: 获取角色列表
- **响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Array | 角色列表 |

### 6. 角色名称是否存在
- **接口地址**: `GET /api/roles/exists/{name}`
- **功能描述**: 校验角色名称是否已存在
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| name | String | 是 | 角色名称 |

- **响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Boolean | 是否存在 |

## 角色权限接口
### 1. 分配菜单权限
- **接口地址**: `PUT /api/roles/{id}/menus`
- **功能描述**: 为角色分配菜单权限
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | String | 是 | 角色ID |

- **请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| menuIds | Array | 是 | 菜单ID列表 |

- **请求示例**:
```json
{
  "menuIds": ["菜单ID1", "菜单ID2"]
}
```

- **响应参数**:
| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 空对象 |

### 2. 查询角色菜单
- **接口地址**: `GET /api/roles/{id}/menus`
- **功能描述**: 查询角色关联的菜单ID列表
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | String | 是 | 角色ID |

- **响应参数**:
| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Array | 菜单ID列表 |

### 3. 清空角色菜单
- **接口地址**: `DELETE /api/roles/{id}/menus`
- **功能描述**: 清空角色菜单权限
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| id | String | 是 | 角色ID |

- **响应参数**:
| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | Object | 空对象 |

## 菜单权限接口
### 1. 分配角色菜单
- **接口地址**: `POST /api/menus/assign/{role}`
- **功能描述**: 通过角色名称分配菜单权限
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| role | String | 是 | 角色名称 |

- **请求参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| menuIds | Array | 是 | 菜单ID列表 |

- **响应参数**: 同“分配菜单权限”

### 2. 角色菜单ID列表
- **接口地址**: `GET /api/menus/role/{role}/ids`
- **功能描述**: 获取角色关联的菜单ID列表
- **路径参数**:

| 参数名 | 类型 | 必填 | 描述 |
|--------|------|------|------|
| role | String | 是 | 角色名称 |

- **响应参数**: 同“查询角色菜单”

### 3. 刷新角色菜单缓存
- **接口地址**: `POST /api/role/menus/refresh-cache`
- **功能描述**: 刷新角色菜单缓存
- **响应参数**:

| 参数名 | 类型 | 描述 |
|--------|------|------|
| code | String | 响应状态码 |
| message | String | 响应消息 |
| data | String | 操作结果信息 |

## 动态权限校验
- 采用 `@PreAuthorize("@permissionService.hasMenu('菜单CODE')")`
- ADMIN 角色默认拥有全部菜单权限

## 重要说明
- 角色名称变更会同步更新用户角色与角色菜单关联
- 角色菜单分配为空会清空该角色权限并刷新缓存
